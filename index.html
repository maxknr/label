<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipping Label Generator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- PWA: Link to the manifest file -->
    <!-- In a real PWA, this manifest.json file would be hosted separately on your server -->
    <link rel="manifest" href="manifest.json">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Lighter background */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 1rem;
        }

        /* Gradient for the header */
        .header-gradient {
            background-image: linear-gradient(to right, #4c51bf, #667eea); /* Indigo gradient */
        }

        /* A4 paper dimensions for print preview (approx. 210mm x 297mm at 96dpi) */
        .a4-sheet {
            width: 210mm; /* A4 width */
            min-height: 297mm; /* A4 height, min to allow growth if labels exceed standard layout */
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15); /* Stronger shadow */
            background-color: white;
            padding: 15mm; /* Consistent padding for all sides */
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Two columns */
            gap: 8mm 10mm; /* Adjusted gap to fit 4 rows per page (vertical-gap horizontal-gap) */
            align-items: start;
            justify-items: start;
            margin-top: 2rem;
            border-radius: 0.75rem; /* Rounded corners for the A4 sheet preview */
        }

        /* Outer wrapper for the label slot - purely for spacing/layout by default, no visible border */
        .label-cut-line-wrapper {
            width: 85mm; /* This defines the full size of the label slot */
            height: 60mm;
            border: none; /* NO BORDER by default */
            box-sizing: border-box; /* Include border in width/height */
            padding: 0; /* No padding for the outer wrapper */
            display: flex; /* Use flexbox to center/fill label-card inside */
            justify-content: center;
            align-items: center;
            background-color: transparent; /* Ensure transparent background around the label */
        }

        /* Class to apply dashed border when cut lines are enabled */
        .label-cut-line-wrapper.with-cut-lines {
            border: 1px dashed #9ca3af; /* Softer dashed line color for preview */
            padding: 1mm; /* Space between dashed line and solid border */
        }

        /* Inner card for the solid label border and content */
        .label-card {
            border: 2px solid #333; /* The solid inner border */
            padding: 0.5rem; /* Padding internal to the label content */
            width: 100%; /* Fill the space provided by the wrapper */
            height: 100%; /* Fill the space provided by the wrapper */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden; /* Hide overflow content if text is too long */
            font-size: 0.85rem;
            line-height: 1.2;
            box-sizing: border-box;
            background-color: white; /* Ensure inner part is white */
        }

        .label-content-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start; /* Align content to the top */
            margin-bottom: 0.5rem;
        }

        .label-section {
            flex: 1; /* Each section takes equal width */
            padding-right: 0.5rem; /* Spacing between from and to */
        }

        .label-section:last-child {
            padding-right: 0;
            padding-left: 0.5rem; /* Spacing between from and to */
        }

        .label-header {
            font-weight: 700; /* Made even bolder */
            margin-bottom: 0.2rem;
            color: #1f2937; /* Darker color for better contrast */
        }

        .from-address, .to-address {
            white-space: pre-wrap; /* Preserves line breaks */
            font-weight: 500; /* Address text itself can be slightly bolder too */
        }

        /* Styles for the textarea to make borders more visible */
        textarea {
            border-color: #9ca3af !important; /* Default border color for better visibility */
        }
        textarea:focus {
            border-color: #4c51bf !important; /* Focus border color */
            box-shadow: 0 0 0 3px rgba(76, 81, 191, 0.3) !important; /* Stronger focus ring */
        }

        /* Print-specific styles (these apply during print media) */
        @media print {
            body {
                background-color: white;
                padding: 0;
                margin: 0;
                display: block; /* Override flexbox for printing */
            }

            .main-content, .header, .footer-description { /* Hide footer description during print */
                display: none !important; /* Hide everything except the print area */
            }

            .a4-sheet {
                display: grid !important; /* Ensure it's displayed */
                width: 210mm;
                height: 297mm;
                box-shadow: none;
                margin: 0;
                padding: 15mm !important; /* Consistent padding for print */
                grid-template-columns: repeat(2, 1fr);
                gap: 8mm 10mm;
                align-items: start;
                justify-items: start;
                border-radius: 0; /* No rounded corners on print */
            }

            .label-cut-line-wrapper {
                border: none !important; /* Ensure no border on wrapper during print by default */
                padding: 0 !important; /* No padding for the outer wrapper during print */
            }
            .label-cut-line-wrapper.with-cut-lines { /* Apply black dashed border if enabled for print */
                border: 1px dashed #000 !important;
                padding: 1mm !important;
            }

            .label-card {
                border: 1px solid #000 !important; /* Solid black border for print */
                padding: 0.5rem !important; /* Ensure consistent padding in print */
            }
            .label-header {
                font-weight: 700; /* Maintain bold for print */
                color: #000;
            }
            /* Add page breaks for every 8 labels in print */
            .label-cut-line-wrapper:nth-child(8n) {
                page-break-after: always;
            }
        }
    </style>
</head>
<body class="selection:bg-indigo-200">
    <div class="header header-gradient w-full text-center py-6 text-white shadow-lg">
        <h1 class="text-3xl font-bold">ðŸ“¦ Shipping Label Generator</h1>
    </div>

    <div class="main-content bg-white p-8 rounded-xl shadow-lg w-full max-w-4xl mt-8">
        <h2 class="text-2xl font-semibold mb-6 text-gray-800">Create Your Labels</h2>

        <p class="mb-6 text-gray-700 leading-relaxed">
            Welcome to the free Shipping Label Generator! Easily create custom shipping labels without any login.
            Just enter your "From" address once, and then add up to eight recipient "To" addresses.
            You'll get a professional-looking sheet of labels, ready to print or download as a PDF.
            Plus, you can save your "From" address for quick access next time!
        </p>

        <div id="label-inputs-container" class="space-y-6 mb-8">
            <!-- Single From Address Block - with new background color and border -->
            <div class="label-input-block p-4 border border-indigo-200 rounded-lg bg-blue-100 shadow-sm">
                <h3 class="text-lg font-medium mb-3 text-gray-700">Your "From" Address</h3>
                <div>
                    <label for="fromAddress" class="block text-sm font-medium text-gray-700">From Address (applies to all labels)</label>
                    <textarea id="fromAddress" rows="3" class="mt-1 block w-full rounded-md border-2 border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" placeholder="Your Name&#10;Your Street&#10;City, State ZIP" oninput="generateLabels()"></textarea>
                </div>
            </div>

            <!-- To Address Blocks (arranged in two columns) -->
            <div class="label-input-block p-4 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                <h3 class="text-lg font-medium mb-3 text-gray-700">Recipient "To" Addresses</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Label 1 -->
                    <div>
                        <label for="toAddress1" class="block text-sm font-medium text-gray-700">Label 1: To Address</label>
                        <textarea id="toAddress1" rows="3" class="mt-1 block w-full rounded-md border-2 border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" placeholder="Recipient Name&#10;Recipient Street&#10;City, State ZIP" oninput="generateLabels()"></textarea>
                    </div>

                    <!-- Label 2 -->
                    <div>
                        <label for="toAddress2" class="block text-sm font-medium text-gray-700">Label 2: To Address</label>
                        <textarea id="toAddress2" rows="3" class="mt-1 block w-full rounded-md border-2 border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" placeholder="Recipient Name&#10;Recipient Street&#10;City, State ZIP" oninput="generateLabels()"></textarea>
                    </div>

                    <!-- Label 3 -->
                    <div>
                        <label for="toAddress3" class="block text-sm font-medium text-gray-700">Label 3: To Address</label>
                        <textarea id="toAddress3" rows="3" class="mt-1 block w-full rounded-md border-2 border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" placeholder="Recipient Name&#10;Recipient Street&#10;City, State ZIP" oninput="generateLabels()"></textarea>
                    </div>

                    <!-- Label 4 -->
                    <div>
                        <label for="toAddress4" class="block text-sm font-medium text-gray-700">Label 4: To Address</label>
                        <textarea id="toAddress4" rows="3" class="mt-1 block w-full rounded-md border-2 border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" placeholder="Recipient Name&#10;Recipient Street&#10;City, State ZIP" oninput="generateLabels()"></textarea>
                    </div>

                    <!-- Label 5 -->
                    <div>
                        <label for="toAddress5" class="block text-sm font-medium text-gray-700">Label 5: To Address</label>
                        <textarea id="toAddress5" rows="3" class="mt-1 block w-full rounded-md border-2 border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" placeholder="Recipient Name&#10;Recipient Street&#10;City, State ZIP" oninput="generateLabels()"></textarea>
                    </div>

                    <!-- Label 6 -->
                    <div>
                        <label for="toAddress6" class="block text-sm font-medium text-gray-700">Label 6: To Address</label>
                        <textarea id="toAddress6" rows="3" class="mt-1 block w-full rounded-md border-2 border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" placeholder="Recipient Name&#10;Recipient Street&#10;City, State ZIP" oninput="generateLabels()"></textarea>
                    </div>

                    <!-- Label 7 -->
                    <div>
                        <label for="toAddress7" class="block text-sm font-medium text-gray-700">Label 7: To Address</label>
                        <textarea id="toAddress7" rows="3" class="mt-1 block w-full rounded-md border-2 border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" placeholder="Recipient Name&#10;Recipient Street&#10;City, State ZIP" oninput="generateLabels()"></textarea>
                    </div>

                    <!-- Label 8 -->
                    <div>
                        <label for="toAddress8" class="block text-sm font-medium text-gray-700">Label 8: To Address</label>
                        <textarea id="toAddress8" rows="3" class="mt-1 block w-full rounded-md border-2 border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" placeholder="Recipient Name&#10;Recipient Street&#10;City, State ZIP" oninput="generateLabels()"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-4 sm:space-y-0 mb-6">
            <div class="flex items-center">
                <input id="rememberFrom" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                <label for="rememberFrom" class="ml-2 block text-sm text-gray-900">Remember "From" address for future use</label>
            </div>
            <div class="flex items-center">
                <input id="includeCutLines" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" onchange="generateLabels()" checked>
                <label for="includeCutLines" class="ml-2 block text-sm text-gray-900">Include Cut Lines in Print/PDF</label>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
            <button onclick="generateLabels()" class="flex-1 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1">
                Generate Labels
            </button>
            <button onclick="printLabels()" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1">
                Print Labels
            </button>
            <button onclick="downloadPdf()" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1">
                Download PDF
            </button>
            <button onclick="clearAllToAddresses()" class="flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1">
                Clear All Recipient Addresses
            </button>
        </div>
    </div>

    <!-- Area for generated labels (A4 sheet preview) -->
    <div id="labels-a4-sheet" class="a4-sheet">
        <!-- Labels will be inserted here by JavaScript -->
    </div>

    <div class="footer-description w-full max-w-4xl mt-8 p-8 bg-white rounded-xl shadow-lg text-gray-700 leading-relaxed">
        <h2 class="text-2xl font-semibold mb-4 text-gray-800">How to Use This Shipping Label Generator</h2>
        <p class="mb-4">
            Our **free online shipping label generator** is designed for simplicity and efficiency. Here's a quick guide to getting your labels ready:
        </p>
        <ol class="list-decimal list-inside space-y-2 mb-6">
            <li>
                <strong>Enter Your "From" Address:</strong> Start by filling out your sender address in the designated "Your 'From' Address" section. This address will automatically populate for all the labels you generate, saving you repetitive typing.
            </li>
            <li>
                <strong>Add Recipient "To" Addresses:</strong> Next, proceed to the "Recipient 'To' Addresses" section. You can enter up to eight different recipient addresses. For each label you need, simply fill in the corresponding "To" address field. If a "To" address field is left blank, that label slot will appear blank in the preview, print, and PDF (no borders or content, unless cut lines are enabled).
            </li>
            <li>
                <strong>Copy and Paste Addresses:</strong> For faster entry, you can easily **copy and paste full addresses** into any of the text fields. Ensure each line of the address is correctly formatted in the input box to appear properly on the label.
            </li>
            <li>
                <strong>Remember Your "From" Address:</strong> Check the "Remember 'From' address for future use" box if you want your sender address to be saved in your browser's local storage for your next visit. This is convenient for regular users.
            </li>
            <li>
                <strong>Include Cut Lines:</strong> Use the "**Include Cut Lines in Print/PDF**" checkbox to toggle the visibility of the dashed outer cut lines around all label slots. This helps with precise cutting if desired.
            </li>
            <li>
                <strong>Clear Recipient Addresses:</strong> Use the "**Clear All Recipient Addresses**" button to quickly empty all "To" address fields, allowing you to start fresh for a new batch of labels.
            </li>
            <li>
                <strong>Generate Labels:</strong> The labels on the A4 preview sheet are automatically generated as you type. If you prefer, you can click the **"Generate Labels"** button to manually refresh the preview based on your inputs.
            </li>
            <li>
                <strong>Print Labels Directly:</strong> Click the **"Print Labels"** button to open your browser's print dialogue. All eight label slots will be printed, with filled labels showing content and their solid inner border. Empty slots will be completely blank, or show only the dashed cut line if enabled. Our layout is optimized to fit eight labels per page, precisely maintaining their grid positions.
            </li>
            <li>
                <strong>Download as PDF:</strong> If you prefer to save your labels digitally or print them later, click the **"Download PDF"** button. A PDF file containing all eight label slots will be created and downloaded to your device, behaving just like the print output.
            </li>
        </ol>

        <h2 class="text-2xl font-semibold mb-4 text-gray-800">Usefulness for Small Businesses</h2>
        <p class="mb-4">
            This **no-login-needed shipping label generator** is an invaluable tool for small businesses, Etsy sellers, e-commerce startups, and anyone who frequently ships packages. Here's why it's a game-changer:
        </p>
        <ul class="list-disc list-inside space-y-2 mb-6">
            <li>
                <strong>Cost-Effective:</strong> Eliminate the need for expensive label printing software or specialized label sheets. Use standard A4 paper and print exactly what you need, when you need it, for **free**.
            </li>
            <li>
                <strong>Time-Saving:</strong> The single "From" address entry significantly speeds up the process for multiple shipments. Rapidly generate batches of labels instead of handwriting them or re-entering your details repeatedly.
            </li>
            <li>
                <strong>Professional Appearance:</strong> Present a polished and professional image to your customers with clear, machine-printed labels. This enhances your brand's credibility and customer satisfaction.
            </li>
            <li>
                <strong>No Account Required:</strong> Unlike many online tools, our generator requires **no registration or login**. This means instant access, no data collection, and zero commitment, making it ideal for quick, one-off tasks or for users who value privacy.
            </li>
            <li>
                <strong>Efficient Use of Paper:</strong> By fitting eight labels perfectly onto a single A4 sheet, you maximize paper usage and minimize waste, contributing to both cost savings and environmental responsibility.
            </li>
            <li>
                <strong>Customizable Output:</strong> The new option to include or exclude cut lines allows you to tailor the output precisely to your needs, whether you prefer clear cutting guides or a super-clean, borderless look for unused areas.
            </li>
            <li>
                <strong>Accessibility:</strong> Being a web-based tool, it's accessible from any device with a browser and internet connection, providing flexibility for your shipping operations whether you're in the office or on the go.
            </li>
        </ul>
        <p>
            Streamline your small business shipping today with this simple, efficient, and completely free tool!
        </p>
    </div>

    <!-- jsPDF and html2canvas CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        /**
         * Loads the remembered "From" address from localStorage on page load.
         */
        function loadRememberedAddress() {
            const rememberedAddress = localStorage.getItem('fromAddress');
            const rememberCheckbox = document.getElementById('rememberFrom');
            const fromAddressField = document.getElementById('fromAddress'); // Get the single "From" field

            if (rememberedAddress && fromAddressField) {
                fromAddressField.value = rememberedAddress;
                rememberCheckbox.checked = true; // Check the box if an address was loaded
            }
        }

        /**
         * Saves the single "From" address to localStorage if the "Remember" checkbox is checked.
         */
        function rememberFromAddress() {
            const rememberCheckbox = document.getElementById('rememberFrom');
            const fromAddressField = document.getElementById('fromAddress');

            if (fromAddressField) { // Ensure the field exists
                if (rememberCheckbox.checked) {
                    localStorage.setItem('fromAddress', fromAddressField.value);
                } else {
                    localStorage.removeItem('fromAddress');
                }
            }
        }

        /**
         * Generates shipping labels based on user input for the on-screen preview.
         * All 8 label slots are always rendered as wrappers.
         * Inner content (solid border, text) is only added for filled addresses.
         * Cut lines are included based on the 'includeCutLines' checkbox.
         */
        function generateLabels() {
            const labelsContainer = document.getElementById('labels-a4-sheet');
            labelsContainer.innerHTML = ''; // Clear previous labels

            const commonFromAddress = document.getElementById('fromAddress')?.value.trim() || ''; // Get the single "From" address
            const includeCutLines = document.getElementById('includeCutLines')?.checked;

            // Iterate through all 8 possible label slots
            for (let i = 0; i < 8; i++) { // Use 0-indexed for array access
                const toAddress = document.getElementById(`toAddress${i + 1}`)?.value.trim() || '';

                const labelCutLineWrapper = document.createElement('div');
                labelCutLineWrapper.className = 'label-cut-line-wrapper';

                // Add cut-lines class if the option is checked
                if (includeCutLines) {
                    labelCutLineWrapper.classList.add('with-cut-lines');
                }

                // Only create and append the inner label-card if there's content for this slot
                if (commonFromAddress && toAddress) {
                    const labelCard = document.createElement('div');
                    labelCard.className = 'label-card';
                    labelCard.innerHTML = `
                        <div class="label-content-row">
                            <div class="label-section">
                                <div class="label-header">FROM:</div>
                                <div class="from-address whitespace-pre-wrap">${commonFromAddress}</div>
                            </div>
                            <div class="label-section">
                                <div class="label-header">TO:</div>
                                <div class="to-address whitespace-pre-wrap">${toAddress}</div>
                            </div>
                        </div>
                    `;
                    labelCutLineWrapper.appendChild(labelCard);
                }
                // Always append the wrapper, even if its content is empty, to maintain grid layout in preview
                labelsContainer.appendChild(labelCutLineWrapper);
            }

            // After generating labels, remember the 'From' address
            rememberFromAddress();
        }

        /**
         * Clears the content of all "To" address input fields and updates the preview.
         */
        function clearAllToAddresses() {
            for (let i = 1; i <= 8; i++) {
                const toAddressField = document.getElementById(`toAddress${i}`);
                if (toAddressField) {
                    toAddressField.value = '';
                }
            }
            generateLabels(); // Update preview after clearing
        }


        /**
         * Creates a temporary, hidden div in the DOM, populates it with all 8 labels
         * (content for filled, blank for empty), captures it with html2canvas, and then removes it.
         * This ensures the full grid layout is always captured for PDF/Print.
         * @returns {Promise<HTMLCanvasElement>} A promise that resolves with the captured canvas.
         */
        async function capturePrintableLabels() {
            const tempDiv = document.createElement('div');
            // Apply A4 sheet styles to the temporary container
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px'; // Position off-screen
            tempDiv.style.width = '210mm';
            tempDiv.style.minHeight = '297mm';
            tempDiv.style.padding = '15mm';
            tempDiv.style.display = 'grid';
            tempDiv.style.gridTemplateColumns = 'repeat(2, 1fr)';
            tempDiv.style.gap = '8mm 10mm';
            tempDiv.style.backgroundColor = 'white'; // Important for html2canvas capture
            document.body.appendChild(tempDiv);

            const commonFromAddress = document.getElementById('fromAddress')?.value.trim() || '';
            const includeCutLines = document.getElementById('includeCutLines')?.checked;


            for (let i = 0; i < 8; i++) {
                const toAddress = document.getElementById(`toAddress${i + 1}`)?.value.trim() || '';

                const labelCutLineWrapper = document.createElement('div');
                labelCutLineWrapper.className = 'label-cut-line-wrapper'; // No border on this wrapper by default

                // Add cut-lines class if the option is checked
                if (includeCutLines) {
                    labelCutLineWrapper.classList.add('with-cut-lines');
                }

                if (commonFromAddress && toAddress) {
                    const labelCard = document.createElement('div');
                    labelCard.className = 'label-card'; // This has the solid border
                    labelCard.innerHTML = `
                        <div class="label-content-row">
                            <div class="label-section">
                                <div class="label-header">FROM:</div>
                                <div class="from-address whitespace-pre-wrap">${commonFromAddress}</div>
                            </div>
                            <div class="label-section">
                                <div class="label-header">TO:</div>
                                <div class="to-address whitespace-pre-wrap">${toAddress}</div>
                            </div>
                        </div>
                    `;
                    labelCutLineWrapper.appendChild(labelCard);
                }
                // Always append the wrapper to maintain the grid layout, even if its content (labelCard) is empty
                tempDiv.appendChild(labelCutLineWrapper);
            }

            try {
                const canvas = await html2canvas(tempDiv, {
                    scale: 2, // Increase scale for better resolution in PDF
                    useCORS: true,
                    backgroundColor: '#ffffff'
                });
                return canvas;
            } finally {
                document.body.removeChild(tempDiv); // Clean up the temporary div
            }
        }

        /**
         * Triggers the browser's print dialog. It constructs a full 8-slot grid in a temporary
         * window, populating only the filled labels and leaving others blank, then prints.
         */
        async function printLabels() {
            console.log('Print Labels button clicked.');

            const commonFromAddress = document.getElementById('fromAddress')?.value.trim() || '';
            let hasAnyValidLabel = false;
            for (let i = 1; i <= 8; i++) {
                if (document.getElementById(`toAddress${i}`)?.value.trim() !== '' && commonFromAddress !== '') {
                    hasAnyValidLabel = true;
                    break;
                }
            }

            if (!hasAnyValidLabel) {
                alert("No valid labels to print. Please ensure you have entered a 'From' address and at least one 'To' address.");
                return;
            }

            const printWindow = window.open('', '_blank');
            printWindow.document.write('<html><head><title>Print Labels</title>');
            const styleTags = document.querySelectorAll('style, link[rel="stylesheet"]');
            styleTags.forEach(tag => printWindow.document.head.appendChild(tag.cloneNode(true)));
            printWindow.document.write('</head><body>');

            // Create a temporary container that mimics the A4 sheet for printing
            const tempPrintContainer = printWindow.document.createElement('div');
            tempPrintContainer.className = 'a4-sheet'; // Apply A4 sheet styles for printing

            const includeCutLines = document.getElementById('includeCutLines')?.checked;

            for (let i = 0; i < 8; i++) {
                const toAddress = document.getElementById(`toAddress${i + 1}`)?.value.trim() || '';

                const slotWrapper = document.createElement('div');
                slotWrapper.className = 'label-cut-line-wrapper'; // No border here by default

                // Add cut-lines class if the option is checked
                if (includeCutLines) {
                    slotWrapper.classList.add('with-cut-lines');
                }

                if (commonFromAddress && toAddress) {
                    const slotCard = document.createElement('div');
                    slotCard.className = 'label-card'; // Has solid border
                    slotCard.innerHTML = `
                        <div class="label-content-row">
                            <div class="label-section">
                                <div class="label-header">FROM:</div>
                                <div class="from-address whitespace-pre-wrap">${commonFromAddress}</div>
                            </div>
                            <div class="label-section">
                                <div class="label-header">TO:</div>
                                <div class="to-address whitespace-pre-wrap">${toAddress}</div>
                            </div>
                        </div>
                    `;
                    slotWrapper.appendChild(slotCard);
                }
                // Always append the wrapper to maintain the grid layout on print, even if empty
                tempPrintContainer.appendChild(slotWrapper);
            }

            printWindow.document.body.appendChild(tempPrintContainer);
            printWindow.document.write('</body></html>');
            printWindow.document.close();

            printWindow.onload = function() {
                printWindow.focus();
                printWindow.print();
            };
        }

        /**
         * Downloads the generated labels as a PDF. It captures a full 8-slot grid
         * (content for filled, blank for empty) using html2canvas.
         */
        async function downloadPdf() {
            console.log('Download PDF button clicked.');

            const commonFromAddress = document.getElementById('fromAddress')?.value.trim() || '';
            let hasAnyValidLabel = false;
            for (let i = 1; i <= 8; i++) {
                if (document.getElementById(`toAddress${i}`)?.value.trim() !== '' && commonFromAddress !== '') {
                    hasAnyValidLabel = true;
                    break;
                }
            }

            if (!hasAnyValidLabel) {
                alert("No valid labels to download. Please ensure you have entered a 'From' address and at least one 'To' address.");
                return;
            }

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');

            const downloadButton = document.querySelector('button[onclick="downloadPdf()"]');
            const originalButtonText = downloadButton.textContent;
            downloadButton.textContent = 'Generating PDF...';
            downloadButton.disabled = true;

            try {
                const canvas = await capturePrintableLabels(); // Use the new capture function
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210; // A4 width in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width; // Maintain aspect ratio

                // For a single A4 page, just add the image
                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);

                pdf.save('shipping-labels.pdf');
            } catch (error) {
                console.error("Error generating PDF:", error);
                alert("Failed to generate PDF. Please try again. Check console for details.");
            } finally {
                downloadButton.textContent = originalButtonText;
                downloadButton.disabled = false;
            }
        }

        // Load remembered address and generate labels when the page loads
        window.onload = function() {
            loadRememberedAddress();
            generateLabels(); // Generate labels on page load
        };
    </script>
</body>
</html>
